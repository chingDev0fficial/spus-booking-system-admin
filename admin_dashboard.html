<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library Booking System - Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="resources/css/dashboard_style.css" />
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>SPUS Library</h2>
        <p>Admin Dashboard</p>
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" class="nav-link active" data-section="overview">
            <i class="fas fa-chart-line"></i>
            <span>Overview</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="bookings">
            <i class="fas fa-calendar-check"></i>
            <span>All Bookings</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="libraries">
            <i class="fas fa-building"></i>
            <span>Libraries Report</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="monthly">
            <i class="fas fa-calendar-alt"></i>
            <span>Monthly Report</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="analytics">
            <i class="fas fa-chart-pie"></i>
            <span>Analytics</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="users">
            <i class="fas fa-users"></i>
            <span>User Statistics</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-section="resources">
            <i class="fas fa-book"></i>
            <span>Resources Statistics</span>
          </a>
        </li>
      </ul>
      <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard Header -->
      <div class="dashboard-header">
        <div>
          <h1 id="section-title">Dashboard Overview</h1>
          <p id="section-subtitle">Monitor your library booking system</p>
          <p style="font-size: 12px; color: #7f8c8d; margin-top: 5px">
            <i
              class="fas fa-circle"
              id="status-indicator"
              style="color: #27ae60; font-size: 8px"
            ></i>
            <span id="last-update">Last updated: Never</span>
            <span style="margin-left: 10px"
              >Auto-refresh: <strong id="auto-refresh-status">ON</strong></span
            >
          </p>
        </div>
        <div class="header-actions">
          <button
            class="btn btn-secondary"
            onclick="toggleAutoRefresh()"
            style="margin-right: 10px"
            id="toggle-refresh-btn"
          >
            <i class="fas fa-pause"></i>
            Pause
          </button>
          <button
            class="btn btn-secondary"
            onclick="refreshData()"
            style="margin-right: 10px"
            id="manual-refresh-btn"
          >
            <i class="fas fa-sync-alt"></i>
            Refresh
          </button>
          <button class="export-btn" onclick="exportReport()">
            <i class="fas fa-download"></i>
            Export Report
          </button>
        </div>
      </div>

      <!-- Filters Section -->
      <div class="filters-section">
        <div class="filters-row">
          <div class="filter-group">
            <label>Library</label>
            <select id="filterLibrary" onchange="applyFilters()">
              <option value="">All Libraries</option>
              <!-- Options will be populated dynamically from API -->
            </select>
          </div>
          <div class="filter-group">
            <label>Date Range</label>
            <select id="filterDateRange" onchange="applyFilters()">
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month" selected>This Month</option>
              <option value="year">This Year</option>
              <option value="custom">Custom Range</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Status</label>
            <select id="filterStatus" onchange="applyFilters()">
              <option value="">All Status</option>
              <option value="Pending">Pending</option>
              <option value="completed">completed</option>
              <option value="cancelled">cancelled</option>
              <option value="Completed">Completed</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Booker Type</label>
            <select id="filterBookerType" onchange="applyFilters()">
              <option value="">All Types</option>
              <option value="student">Student</option>
              <option value="faculty">Faculty</option>
            </select>
          </div>
          <div class="filter-group">
            <button class="btn btn-secondary" onclick="resetFilters()">
              <i class="fas fa-redo"></i> Reset
            </button>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading dashboard data...</p>
      </div>

      <!-- Dashboard Content -->
      <div id="dashboard-content">
        <!-- Overview Section -->
        <div id="section-overview" class="dashboard-section">
          <!-- Stats Cards -->
          <div class="stats-grid">
            <div class="stat-card blue">
              <div class="stat-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <div class="stat-label">Total Bookings</div>
              <div class="stat-value" id="stat-total">0</div>
              <div class="stat-change positive" id="stat-total-change">
                <i class="fas fa-arrow-up"></i> 0% from last month
              </div>
            </div>

            <div class="stat-card green">
              <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="stat-label">Completed</div>
              <div class="stat-value" id="stat-completed">0</div>
              <div class="stat-change positive" id="stat-completed-change">
                <i class="fas fa-arrow-up"></i> 0% completed rate
              </div>
            </div>

            <div class="stat-card orange">
              <div class="stat-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-label">Pending</div>
              <div class="stat-value" id="stat-pending">0</div>
              <div class="stat-change" id="stat-pending-change">
                Awaiting review
              </div>
            </div>

            <div class="stat-card red">
              <div class="stat-icon">
                <i class="fas fa-times-circle"></i>
              </div>
              <div class="stat-label">Cancelled</div>
              <div class="stat-value" id="stat-cancelled">0</div>
              <div class="stat-change negative" id="stat-cancelled-change">
                <i class="fas fa-arrow-down"></i> 0% cancelled rate
              </div>
            </div>

            <div class="stat-card purple">
              <div class="stat-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-label">Total Users</div>
              <div class="stat-value" id="stat-users">0</div>
              <div class="stat-change" id="stat-users-change">
                Unique bookers
              </div>
            </div>

            <div class="stat-card teal">
              <div class="stat-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-label">Total Hours Booked</div>
              <div class="stat-value" id="stat-hours">0</div>
              <div class="stat-change" id="stat-hours-change">
                Avg 0 hrs/booking
              </div>
            </div>
          </div>

          <!-- Charts Row 1 -->
          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Bookings Trend</h3>
                <p>Daily bookings over time</p>
              </div>
              <div class="chart-container">
                <canvas id="bookingsTrendChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Status Distribution</h3>
                <p>Breakdown by booking status</p>
              </div>
              <div class="chart-container">
                <canvas id="statusChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Charts Row 2 -->
          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Library Usage</h3>
                <p>Bookings per library</p>
              </div>
              <div class="chart-container">
                <canvas id="libraryChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Peak Hours</h3>
                <p>Most popular booking times</p>
              </div>
              <div class="chart-container">
                <canvas id="peakHoursChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Charts Row 3 -->
          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Booker Types</h3>
                <p>Distribution by user type</p>
              </div>
              <div class="chart-container">
                <canvas id="bookerTypeChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Monthly Comparison</h3>
                <p>Bookings by month</p>
              </div>
              <div class="chart-container">
                <canvas id="monthlyChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Recent Bookings Table -->
          <div class="table-card">
            <div class="table-header">
              <h3>Recent Bookings</h3>
              <div class="table-actions">
                <div class="search-box">
                  <input
                    type="text"
                    id="searchInput"
                    placeholder="Search bookings..."
                    onkeyup="searchBookings()"
                  />
                  <i class="fas fa-search"></i>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table id="bookingsTable">
                <thead>
                  <tr>
                    <th>Reference</th>
                    <th>Booking Name</th>
                    <th>Type</th>
                    <th>Library</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th>Hours</th>
                  </tr>
                </thead>
                <tbody id="bookingsTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- End Overview Section -->

        <!-- All Bookings Section -->
        <div
          id="section-bookings"
          class="dashboard-section"
          style="display: none"
        >
          <div class="table-card">
            <div class="table-header">
              <h3>All Bookings Management</h3>
              <div class="table-actions">
                <div class="search-box">
                  <input
                    type="text"
                    id="searchInputAll"
                    placeholder="Search all bookings..."
                    onkeyup="searchAllBookings()"
                  />
                  <i class="fas fa-search"></i>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Reference</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Email</th>
                    <th>Library</th>
                    <th>Facility</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="allBookingsTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
            <div id="pagination" style="text-align: center; margin-top: 20px">
              <!-- Pagination will be added here -->
            </div>
          </div>
        </div>
        <!-- End All Bookings Section -->

        <!-- Libraries Report Section -->
        <div
          id="section-libraries"
          class="dashboard-section"
          style="display: none"
        >
          <div class="stats-grid" id="libraryStatsGrid">
            <!-- Library-specific stats will be loaded here -->
          </div>

          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Library Comparison</h3>
                <p>Bookings across all libraries</p>
              </div>
              <div class="chart-container">
                <canvas id="libraryComparisonChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Library Utilization Rate</h3>
                <p>Percentage of usage</p>
              </div>
              <div class="chart-container">
                <canvas id="libraryUtilizationChart"></canvas>
              </div>
            </div>
          </div>

          <div class="table-card">
            <div class="table-header">
              <h3>Library Details</h3>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Library</th>
                    <th>Total Bookings</th>
                    <th>Pending</th>
                    <th>Completed</th>
                    <th>Total Hours</th>
                    <th>Avg Hours/Booking</th>
                    <th>Most Used Facility</th>
                  </tr>
                </thead>
                <tbody id="libraryDetailsTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- End Libraries Report Section -->

        <!-- Monthly Report Section -->
        <div
          id="section-monthly"
          class="dashboard-section"
          style="display: none"
        >
          <div class="stats-grid">
            <div class="stat-card blue">
              <div class="stat-icon"><i class="fas fa-calendar"></i></div>
              <div class="stat-label">This Month</div>
              <div class="stat-value" id="stat-this-month">0</div>
              <div class="stat-change" id="stat-this-month-change"></div>
            </div>
            <div class="stat-card green">
              <div class="stat-icon"><i class="fas fa-arrow-up"></i></div>
              <div class="stat-label">Last Month</div>
              <div class="stat-value" id="stat-last-month">0</div>
              <div class="stat-change" id="stat-last-month-change"></div>
            </div>
            <div class="stat-card purple">
              <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
              <div class="stat-label">Growth Rate</div>
              <div class="stat-value" id="stat-growth-rate">0%</div>
              <div class="stat-change" id="stat-growth-rate-change"></div>
            </div>
            <div class="stat-card orange">
              <div class="stat-icon"><i class="fas fa-trophy"></i></div>
              <div class="stat-label">Best Month</div>
              <div class="stat-value" id="stat-best-month">-</div>
              <div class="stat-change" id="stat-best-month-change"></div>
            </div>
          </div>

          <div class="charts-row">
            <div class="chart-card" style="grid-column: 1 / -1">
              <div class="chart-header">
                <h3>Monthly Bookings Trend</h3>
                <p>Last 12 months comparison</p>
              </div>
              <div class="chart-container">
                <canvas id="monthlyTrendChart"></canvas>
              </div>
            </div>
          </div>

          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Month-over-Month Status</h3>
                <p>Status breakdown by month</p>
              </div>
              <div class="chart-container">
                <canvas id="monthlyStatusChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Monthly User Types</h3>
                <p>Student vs Faculty trend</p>
              </div>
              <div class="chart-container">
                <canvas id="monthlyUserTypeChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <!-- End Monthly Report Section -->

        <!-- Analytics Section -->
        <div
          id="section-analytics"
          class="dashboard-section"
          style="display: none"
        >
          <div class="stats-grid">
            <div class="stat-card blue">
              <div class="stat-icon"><i class="fas fa-clock"></i></div>
              <div class="stat-label">Avg Booking Duration</div>
              <div class="stat-value" id="stat-avg-duration">0</div>
              <div class="stat-change">hours per booking</div>
            </div>
            <div class="stat-card green">
              <div class="stat-icon"><i class="fas fa-fire"></i></div>
              <div class="stat-label">Peak Hour</div>
              <div class="stat-value" id="stat-peak-hour">-</div>
              <div class="stat-change">most popular time</div>
            </div>
            <div class="stat-card purple">
              <div class="stat-icon"><i class="fas fa-star"></i></div>
              <div class="stat-label">Top Library</div>
              <div class="stat-value" id="stat-top-library">-</div>
              <div class="stat-change">most booked</div>
            </div>
            <div class="stat-card orange">
              <div class="stat-icon"><i class="fas fa-graduation-cap"></i></div>
              <div class="stat-label">Top Booker Type</div>
              <div class="stat-value" id="stat-top-booker">-</div>
              <div class="stat-change">most active</div>
            </div>
          </div>

          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Booking Duration Distribution</h3>
                <p>Hours distribution</p>
              </div>
              <div class="chart-container">
                <canvas id="durationDistributionChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Day of Week Analysis</h3>
                <p>Busiest days</p>
              </div>
              <div class="chart-container">
                <canvas id="dayOfWeekChart"></canvas>
              </div>
            </div>
          </div>

          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Hourly Heatmap</h3>
                <p>Booking patterns by hour</p>
              </div>
              <div class="chart-container">
                <canvas id="hourlyHeatmapChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Purpose Analysis</h3>
                <p>Top 10 booking purposes</p>
              </div>
              <div
                class="chart-container"
                style="max-height: 300px; overflow-y: auto"
              >
                <div id="purposeAnalysisList"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- End Analytics Section -->

        <!-- User Statistics Section -->
        <div id="section-users" class="dashboard-section" style="display: none">
          <div class="stats-grid">
            <div class="stat-card blue">
              <div class="stat-icon"><i class="fas fa-users"></i></div>
              <div class="stat-label">Total Users</div>
              <div class="stat-value" id="stat-total-users">0</div>
              <div class="stat-change">unique bookers</div>
            </div>
            <div class="stat-card green">
              <div class="stat-icon"><i class="fas fa-user-graduate"></i></div>
              <div class="stat-label">Students</div>
              <div class="stat-value" id="stat-students">0</div>
              <div class="stat-change" id="stat-students-change"></div>
            </div>
            <div class="stat-card purple">
              <div class="stat-icon">
                <i class="fas fa-chalkboard-teacher"></i>
              </div>
              <div class="stat-label">Faculty</div>
              <div class="stat-value" id="stat-faculty">0</div>
              <div class="stat-change" id="stat-faculty-change"></div>
            </div>
            <div class="stat-card orange">
              <div class="stat-icon"><i class="fas fa-crown"></i></div>
              <div class="stat-label">Top User</div>
              <div
                class="stat-value"
                id="stat-top-user"
                style="font-size: 18px"
              >
                -
              </div>
              <div class="stat-change" id="stat-top-user-bookings"></div>
            </div>
          </div>

          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Top 10 Most Active Users</h3>
                <p>Users with most bookings</p>
              </div>
              <div class="chart-container">
                <canvas id="topUsersChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>User Type Distribution</h3>
                <p>Students vs Faculty</p>
              </div>
              <div class="chart-container">
                <canvas id="userTypeDistributionChart"></canvas>
              </div>
            </div>
          </div>

          <div class="table-card">
            <div class="table-header">
              <h3>User Details</h3>
              <div class="table-actions">
                <div class="search-box">
                  <input
                    type="text"
                    id="searchUsers"
                    placeholder="Search users..."
                    onkeyup="searchUsers()"
                  />
                  <i class="fas fa-search"></i>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table>
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Type</th>
                    <th>Total Bookings</th>
                    <th>Pending</th>
                    <th>Completed</th>
                    <th>Total Hours</th>
                    <th>Last Booking</th>
                  </tr>
                </thead>
                <tbody id="userDetailsTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Resources Statistics Section -->
        <div
          id="section-resources"
          class="dashboard-section"
          style="display: none"
        >
          <div class="stats-grid">
            <div class="stat-card blue">
              <div class="stat-icon"><i class="fas fa-book"></i></div>
              <div class="stat-label">Total Resources Booked</div>
              <div class="stat-value" id="stat-total-resources">0</div>
              <div class="stat-change" id="stat-total-resources-change">All time bookings</div>
            </div>
            <div class="stat-card green">
              <div class="stat-icon"><i class="fas fa-home"></i></div>
              <div class="stat-label">Home Utilization</div>
              <div class="stat-value" id="stat-home-utilization">0</div>
              <div class="stat-change" id="stat-home-utilization-change">0% of total</div>
            </div>
            <div class="stat-card purple">
              <div class="stat-icon"><i class="fas fa-building"></i></div>
              <div class="stat-label">Inside Utilization</div>
              <div class="stat-value" id="stat-inside-utilization">0</div>
              <div class="stat-change" id="stat-inside-utilization-change">0% of total</div>
            </div>
            <div class="stat-card orange">
              <div class="stat-icon"><i class="fas fa-star"></i></div>
              <div class="stat-label">Most Popular Material</div>
              <div class="stat-value" id="stat-popular-material" style="font-size: 18px">-</div>
              <div class="stat-change" id="stat-popular-material-change">0 bookings</div>
            </div>
            <div class="stat-card teal">
              <div class="stat-icon"><i class="fas fa-users"></i></div>
              <div class="stat-label">Unique Users</div>
              <div class="stat-value" id="stat-resource-users">0</div>
              <div class="stat-change">Active borrowers</div>
            </div>
            <div class="stat-card red">
              <div class="stat-icon"><i class="fas fa-user-graduate"></i></div>
              <div class="stat-label">Student Bookings</div>
              <div class="stat-value" id="stat-student-resources">0</div>
              <div class="stat-change" id="stat-student-resources-change">0% of total</div>
            </div>
          </div>

          <!-- Charts Row 1 -->
          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Resources Booking Trend</h3>
                <p>Daily resource bookings over time</p>
              </div>
              <div class="chart-container">
                <canvas id="resourcesTrendChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Material Type Distribution</h3>
                <p>Breakdown by material type</p>
              </div>
              <div class="chart-container">
                <canvas id="materialTypeChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Charts Row 2 -->
          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Utilization Type</h3>
                <p>Home vs Inside usage</p>
              </div>
              <div class="chart-container">
                <canvas id="utilizationTypeChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Charts Row 3 -->
          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <h3>Booker Type Distribution</h3>
                <p>Student vs Faculty</p>
              </div>
              <div class="chart-container">
                <canvas id="resourceBookerTypeChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <h3>Monthly Resource Bookings</h3>
                <p>Trends by month</p>
              </div>
              <div class="chart-container">
                <canvas id="resourceMonthlyChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Resources Table -->
          <div class="table-card">
            <div class="table-header">
              <h3>Recent Resource Bookings</h3>
              <div class="table-actions">
                <div class="search-box">
                  <input
                    type="text"
                    id="searchResourcesInput"
                    placeholder="Search resources..."
                    onkeyup="searchResources()"
                  />
                  <i class="fas fa-search"></i>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table id="resourcesTable">
                <thead>
                  <tr>
                    <th>Reference</th>
                    <th>Booker Name</th>
                    <th>Booker Type</th>
                    <th>Email</th>
                    <th>Material Type</th>
                    <th>Utilization</th>
                    <th>Resource ID</th>
                    <th>Date</th>
                    <th>Timestamp</th>
                  </tr>
                </thead>
                <tbody id="resourcesTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- End Resources Statistics Section -->
    </main>

    <script src="resources/js/dashboard_script.js"></script>
  </body>
</html>
